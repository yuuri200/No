<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .task-card {
            transition: all 0.2s ease;
        }
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .priority-high {
            border-left: 4px solid #ef4444;
        }
        .priority-medium {
            border-left: 4px solid #f59e0b;
        }
        .priority-low {
            border-left: 4px solid #10b981;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .calendar-day {
            transition: all 0.2s ease;
        }
        .calendar-day:hover {
            background-color: #e5e7eb;
        }
        .calendar-day.today {
            background-color: #3b82f6;
            color: white;
        }
        .calendar-day.has-tasks {
            background-color: #dbeafe;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-blue-700 mb-2">Schedule Tracker</h1>
            <p class="text-gray-600">Organize your tasks and manage your time effectively</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- Sidebar -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Calendar -->
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex justify-between items-center mb-4">
                        <button id="prev-month" class="text-gray-500 hover:text-blue-600">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <h2 id="current-month" class="font-semibold text-lg">Month Year</h2>
                        <button id="next-month" class="text-gray-500 hover:text-blue-600">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div id="calendar" class="grid grid-cols-7 gap-1 text-center text-sm"></div>
                </div>

                <!-- Stats -->
                <div class="bg-white rounded-xl shadow p-4">
                    <h2 class="font-semibold text-lg mb-3">Task Statistics</h2>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">Total Tasks</span>
                                <span id="total-tasks" class="font-medium">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div id="total-bar" class="bg-blue-600 h-1.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">Completed</span>
                                <span id="completed-tasks" class="font-medium">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div id="completed-bar" class="bg-green-500 h-1.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">Pending</span>
                                <span id="pending-tasks" class="font-medium">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div id="pending-bar" class="bg-yellow-500 h-1.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-600">Overdue</span>
                                <span id="overdue-tasks" class="font-medium">0</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-1.5">
                                <div id="overdue-bar" class="bg-red-500 h-1.5 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div class="bg-white rounded-xl shadow p-4">
                    <h2 class="font-semibold text-lg mb-3">Categories</h2>
                    <div id="category-list" class="space-y-2">
                        <div class="flex items-center">
                            <div class="w-3 h-3 rounded-full bg-blue-500 mr-2"></div>
                            <span class="text-sm">Work</span>
                        </div>
                        <!-- Categories will be added here dynamically -->
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="lg:col-span-3 space-y-6">
                <!-- Task Form -->
                <div class="bg-white rounded-xl shadow p-6">
                    <h2 class="text-xl font-semibold mb-4">Add New Task</h2>
                    <form id="task-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="task-title" class="block text-sm font-medium text-gray-700 mb-1">Title*</label>
                                <input type="text" id="task-title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Task title">
                            </div>
                            <div>
                                <label for="task-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                                <select id="task-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="work">Work</option>
                                    <option value="personal">Personal</option>
                                    <option value="study">Study</option>
                                    <option value="health">Health</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label for="task-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="task-description" rows="2" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Task description"></textarea>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="task-date" class="block text-sm font-medium text-gray-700 mb-1">Due Date*</label>
                                <input type="date" id="task-date" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            <div>
                                <label for="task-priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                                <select id="task-priority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="high">High</option>
                                    <option value="medium" selected>Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div>
                                <label for="task-time" class="block text-sm font-medium text-gray-700 mb-1">Time (optional)</label>
                                <input type="time" id="task-time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button type="reset" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Clear
                            </button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                Add Task
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Task Filters -->
                <div class="bg-white rounded-xl shadow p-4">
                    <div class="flex flex-wrap items-center justify-between gap-3">
                        <div class="flex items-center space-x-2">
                            <label for="filter-status" class="text-sm font-medium text-gray-700">Status:</label>
                            <select id="filter-status" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">All</option>
                                <option value="pending">Pending</option>
                                <option value="completed">Completed</option>
                                <option value="overdue">Overdue</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="filter-priority" class="text-sm font-medium text-gray-700">Priority:</label>
                            <select id="filter-priority" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">All</option>
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="filter-category" class="text-sm font-medium text-gray-700">Category:</label>
                            <select id="filter-category" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">All</option>
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                                <option value="study">Study</option>
                                <option value="health">Health</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="flex items-center space-x-2">
                            <label for="filter-date" class="text-sm font-medium text-gray-700">Date:</label>
                            <select id="filter-date" class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="all">All Dates</option>
                                <option value="today">Today</option>
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="future">Upcoming</option>
                                <option value="past">Past</option>
                            </select>
                        </div>
                        <button id="clear-filters" class="px-3 py-1 text-sm text-blue-600 hover:text-blue-800">
                            Clear Filters
                        </button>
                    </div>
                </div>

                <!-- Tasks List -->
                <div class="bg-white rounded-xl shadow overflow-hidden">
                    <div class="border-b border-gray-200 px-6 py-4 flex justify-between items-center">
                        <h2 class="text-lg font-semibold">Your Tasks</h2>
                        <div class="text-sm text-gray-500">
                            <span id="filtered-count">0</span> of <span id="total-count">0</span> tasks shown
                        </div>
                    </div>
                    <div id="tasks-container" class="divide-y divide-gray-200">
                        <div class="p-6 text-center text-gray-500">
                            No tasks found. Add your first task above!
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Edit Task</h3>
                    <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <form id="edit-form" class="space-y-4">
                    <input type="hidden" id="edit-id">
                    <div>
                        <label for="edit-title" class="block text-sm font-medium text-gray-700 mb-1">Title*</label>
                        <input type="text" id="edit-title" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label for="edit-description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea id="edit-description" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="edit-category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select id="edit-category" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="work">Work</option>
                                <option value="personal">Personal</option>
                                <option value="study">Study</option>
                                <option value="health">Health</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="edit-priority" class="block text-sm font-medium text-gray-700 mb-1">Priority</label>
                            <select id="edit-priority" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="high">High</option>
                                <option value="medium">Medium</option>
                                <option value="low">Low</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="edit-date" class="block text-sm font-medium text-gray-700 mb-1">Due Date*</label>
                            <input type="date" id="edit-date" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="edit-time" class="block text-sm font-medium text-gray-700 mb-1">Time (optional)</label>
                            <input type="time" id="edit-time" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancel-edit" class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize variables
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        let currentDate = new Date();
        let currentMonth = currentDate.getMonth();
        let currentYear = currentDate.getFullYear();

        // DOM Elements
        const taskForm = document.getElementById('task-form');
        const tasksContainer = document.getElementById('tasks-container');
        const totalTasksElement = document.getElementById('total-tasks');
        const completedTasksElement = document.getElementById('completed-tasks');
        const pendingTasksElement = document.getElementById('pending-tasks');
        const overdueTasksElement = document.getElementById('overdue-tasks');
        const totalBarElement = document.getElementById('total-bar');
        const completedBarElement = document.getElementById('completed-bar');
        const pendingBarElement = document.getElementById('pending-bar');
        const overdueBarElement = document.getElementById('overdue-bar');
        const categoryListElement = document.getElementById('category-list');
        const currentMonthElement = document.getElementById('current-month');
        const calendarElement = document.getElementById('calendar');
        const prevMonthButton = document.getElementById('prev-month');
        const nextMonthButton = document.getElementById('next-month');
        const filteredCountElement = document.getElementById('filtered-count');
        const totalCountElement = document.getElementById('total-count');
        const editModal = document.getElementById('edit-modal');
        const editForm = document.getElementById('edit-form');
        const closeModalButton = document.getElementById('close-modal');
        const cancelEditButton = document.getElementById('cancel-edit');

        // Filter elements
        const filterStatus = document.getElementById('filter-status');
        const filterPriority = document.getElementById('filter-priority');
        const filterCategory = document.getElementById('filter-category');
        const filterDate = document.getElementById('filter-date');
        const clearFiltersButton = document.getElementById('clear-filters');

        // Category colors
        const categoryColors = {
            work: 'bg-blue-500',
            personal: 'bg-purple-500',
            study: 'bg-green-500',
            health: 'bg-red-500',
            other: 'bg-gray-500'
        };

        // Category names
        const categoryNames = {
            work: 'Work',
            personal: 'Personal',
            study: 'Study',
            health: 'Health',
            other: 'Other'
        };

        // Priority colors and icons
        const priorityStyles = {
            high: {
                color: 'text-red-600',
                icon: 'fas fa-exclamation-circle',
                bg: 'bg-red-50'
            },
            medium: {
                color: 'text-yellow-600',
                icon: 'fas fa-exclamation-triangle',
                bg: 'bg-yellow-50'
            },
            low: {
                color: 'text-green-600',
                icon: 'fas fa-arrow-down',
                bg: 'bg-green-50'
            }
        };

        // Initialize the app
        function init() {
            // Set default date to today
            document.getElementById('task-date').valueAsDate = new Date();
            
            // Load tasks
            updateTasksList();
            updateStats();
            updateCalendar();
            updateCategoryList();
            
            // Add event listeners
            taskForm.addEventListener('submit', addTask);
            prevMonthButton.addEventListener('click', () => changeMonth(-1));
            nextMonthButton.addEventListener('click', () => changeMonth(1));
            
            // Filter event listeners
            filterStatus.addEventListener('change', updateTasksList);
            filterPriority.addEventListener('change', updateTasksList);
            filterCategory.addEventListener('change', updateTasksList);
            filterDate.addEventListener('change', updateTasksList);
            clearFiltersButton.addEventListener('click', clearFilters);
            
            // Modal event listeners
            closeModalButton.addEventListener('click', closeModal);
            cancelEditButton.addEventListener('click', closeModal);
            editForm.addEventListener('submit', saveEditedTask);
        }

        // Add a new task
        function addTask(e) {
            e.preventDefault();
            
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const category = document.getElementById('task-category').value;
            const priority = document.getElementById('task-priority').value;
            const date = document.getElementById('task-date').value;
            const time = document.getElementById('task-time').value;
            
            if (!title || !date) {
                alert('Please fill in all required fields');
                return;
            }
            
            const dueDate = new Date(date);
            if (time) {
                const [hours, minutes] = time.split(':');
                dueDate.setHours(parseInt(hours), parseInt(minutes));
            }
            
            const task = {
                id: Date.now(),
                title,
                description,
                category,
                priority,
                dueDate: dueDate.toISOString(),
                completed: false,
                createdAt: new Date().toISOString()
            };
            
            tasks.unshift(task);
            saveTasks();
            
            // Reset form
            taskForm.reset();
            document.getElementById('task-date').valueAsDate = new Date();
            
            // Update UI
            updateTasksList();
            updateStats();
            updateCalendar();
            updateCategoryList();
        }

        // Edit a task
        function editTask(id) {
            const task = tasks.find(t => t.id === id);
            if (!task) return;
            
            document.getElementById('edit-id').value = task.id;
            document.getElementById('edit-title').value = task.title;
            document.getElementById('edit-description').value = task.description || '';
            document.getElementById('edit-category').value = task.category;
            document.getElementById('edit-priority').value = task.priority;
            
            const dueDate = new Date(task.dueDate);
            document.getElementById('edit-date').valueAsDate = dueDate;
            
            // Set time if it exists
            if (dueDate.getHours() !== 0 || dueDate.getMinutes() !== 0) {
                const hours = String(dueDate.getHours()).padStart(2, '0');
                const minutes = String(dueDate.getMinutes()).padStart(2, '0');
                document.getElementById('edit-time').value = `${hours}:${minutes}`;
            } else {
                document.getElementById('edit-time').value = '';
            }
            
            // Show modal
            editModal.classList.remove('hidden');
        }

        // Save edited task
        function saveEditedTask(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('edit-id').value);
            const title = document.getElementById('edit-title').value.trim();
            const description = document.getElementById('edit-description').value.trim();
            const category = document.getElementById('edit-category').value;
            const priority = document.getElementById('edit-priority').value;
            const date = document.getElementById('edit-date').value;
            const time = document.getElementById('edit-time').value;
            
            if (!title || !date) {
                alert('Please fill in all required fields');
                return;
            }
            
            const dueDate = new Date(date);
            if (time) {
                const [hours, minutes] = time.split(':');
                dueDate.setHours(parseInt(hours), parseInt(minutes));
            }
            
            const taskIndex = tasks.findIndex(t => t.id === id);
            if (taskIndex !== -1) {
                tasks[taskIndex] = {
                    ...tasks[taskIndex],
                    title,
                    description,
                    category,
                    priority,
                    dueDate: dueDate.toISOString()
                };
                
                saveTasks();
                updateTasksList();
                updateStats();
                updateCalendar();
                updateCategoryList();
            }
            
            closeModal();
        }

        // Close modal
        function closeModal() {
            editModal.classList.add('hidden');
        }

        // Toggle task completion status
        function toggleTaskCompletion(id) {
            const task = tasks.find(t => t.id === id);
            if (task) {
                task.completed = !task.completed;
                saveTasks();
                updateTasksList();
                updateStats();
                updateCalendar();
            }
        }

        // Delete a task
        function deleteTask(id) {
            if (confirm('Are you sure you want to delete this task?')) {
                tasks = tasks.filter(task => task.id !== id);
                saveTasks();
                updateTasksList();
                updateStats();
                updateCalendar();
                updateCategoryList();
            }
        }

        // Save tasks to localStorage
        function saveTasks() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
        }

        // Update tasks list based on filters
        function updateTasksList() {
            const statusFilter = filterStatus.value;
            const priorityFilter = filterPriority.value;
            const categoryFilter = filterCategory.value;
            const dateFilter = filterDate.value;
            
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            const endOfToday = new Date(today);
            endOfToday.setHours(23, 59, 59, 999);
            
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            endOfWeek.setHours(23, 59, 59, 999);
            
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            const endOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            endOfMonth.setHours(23, 59, 59, 999);
            
            let filteredTasks = [...tasks];
            
            // Apply status filter
            if (statusFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => {
                    if (statusFilter === 'completed') return task.completed;
                    if (statusFilter === 'pending') return !task.completed && new Date(task.dueDate) > new Date();
                    if (statusFilter === 'overdue') return !task.completed && new Date(task.dueDate) < new Date();
                    return true;
                });
            }
            
            // Apply priority filter
            if (priorityFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.priority === priorityFilter);
            }
            
            // Apply category filter
            if (categoryFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => task.category === categoryFilter);
            }
            
            // Apply date filter
            if (dateFilter !== 'all') {
                filteredTasks = filteredTasks.filter(task => {
                    const taskDate = new Date(task.dueDate);
                    
                    if (dateFilter === 'today') {
                        return taskDate >= today && taskDate <= endOfToday;
                    }
                    if (dateFilter === 'week') {
                        return taskDate >= startOfWeek && taskDate <= endOfWeek;
                    }
                    if (dateFilter === 'month') {
                        return taskDate >= startOfMonth && taskDate <= endOfMonth;
                    }
                    if (dateFilter === 'future') {
                        return taskDate > new Date();
                    }
                    if (dateFilter === 'past') {
                        return taskDate < new Date();
                    }
                    return true;
                });
            }
            
            // Sort tasks: overdue first, then by due date, then by creation date
            filteredTasks.sort((a, b) => {
                const aDue = new Date(a.dueDate);
                const bDue = new Date(b.dueDate);
                const now = new Date();
                
                // Overdue tasks come first
                if (!a.completed && aDue < now && (b.completed || bDue >= now)) return -1;
                if (!b.completed && bDue < now && (a.completed || aDue >= now)) return 1;
                
                // Then sort by due date
                if (aDue < bDue) return -1;
                if (aDue > bDue) return 1;
                
                // Then by creation date (newest first)
                return new Date(b.createdAt) - new Date(a.createdAt);
            });
            
            // Update counts
            totalCountElement.textContent = tasks.length;
            filteredCountElement.textContent = filteredTasks.length;
            
            // Display tasks
            if (filteredTasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="p-6 text-center text-gray-500">
                        No tasks found matching your filters.
                    </div>
                `;
                return;
            }
            
            tasksContainer.innerHTML = filteredTasks.map(task => {
                const dueDate = new Date(task.dueDate);
                const now = new Date();
                const isOverdue = !task.completed && dueDate < now;
                
                const formattedDate = dueDate.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                
                let formattedTime = '';
                if (dueDate.getHours() !== 0 || dueDate.getMinutes() !== 0) {
                    formattedTime = dueDate.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
                
                const priorityStyle = priorityStyles[task.priority];
                const categoryColor = categoryColors[task.category];
                
                return `
                    <div class="task-card fade-in p-4 border-l-4 ${isOverdue ? 'priority-high' : task.priority === 'high' ? 'priority-high' : task.priority === 'medium' ? 'priority-medium' : 'priority-low'}">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-3">
                                <button onclick="toggleTaskCompletion(${task.id})" class="mt-1 flex-shrink-0">
                                    <i class="${task.completed ? 'fas fa-check-circle text-green-500' : 'far fa-circle text-gray-300'} text-lg"></i>
                                </button>
                                <div>
                                    <div class="flex items-center flex-wrap gap-2">
                                        <h3 class="${task.completed ? 'line-through text-gray-400' : 'text-gray-800'} font-medium">${task.title}</h3>
                                        <span class="text-xs px-2 py-1 rounded-full ${priorityStyle.bg} ${priorityStyle.color}">
                                            <i class="${priorityStyle.icon} mr-1"></i>
                                            ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                                        </span>
                                        <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600">
                                            <span class="inline-block w-2 h-2 rounded-full ${categoryColor} mr-1"></span>
                                            ${categoryNames[task.category]}
                                        </span>
                                    </div>
                                    ${task.description ? `<p class="text-sm text-gray-600 mt-1">${task.description}</p>` : ''}
                                    <div class="flex items-center mt-2 text-sm ${isOverdue ? 'text-red-500' : 'text-gray-500'}">
                                        <i class="far fa-calendar-alt mr-1"></i>
                                        ${formattedDate}${formattedTime ? ` • ${formattedTime}` : ''}
                                        ${isOverdue ? ' • Overdue' : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editTask(${task.id})" class="text-gray-400 hover:text-blue-500">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                                <button onclick="deleteTask(${task.id})" class="text-gray-400 hover:text-red-500">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Update statistics
        function updateStats() {
            const total = tasks.length;
            const completed = tasks.filter(t => t.completed).length;
            const pending = tasks.filter(t => !t.completed && new Date(t.dueDate) > new Date()).length;
            const overdue = tasks.filter(t => !t.completed && new Date(t.dueDate) < new Date()).length;
            
            totalTasksElement.textContent = total;
            completedTasksElement.textContent = completed;
            pendingTasksElement.textContent = pending;
            overdueTasksElement.textContent = overdue;
            
            // Update progress bars
            const max = Math.max(total, 1);
            totalBarElement.style.width = '100%';
            completedBarElement.style.width = `${(completed / max) * 100}%`;
            pendingBarElement.style.width = `${(pending / max) * 100}%`;
            overdueBarElement.style.width = `${(overdue / max) * 100}%`;
        }

        // Update category list
        function updateCategoryList() {
            const categoryCounts = {};
            
            tasks.forEach(task => {
                categoryCounts[task.category] = (categoryCounts[task.category] || 0) + 1;
            });
            
            // Sort categories by count (descending)
            const sortedCategories = Object.entries(categoryCounts)
                .sort((a, b) => b[1] - a[1])
                .map(([category]) => category);
            
            // Add all categories, even if they have 0 tasks
            for (const category in categoryNames) {
                if (!sortedCategories.includes(category)) {
                    sortedCategories.push(category);
                }
            }
            
            categoryListElement.innerHTML = sortedCategories.map(category => `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full ${categoryColors[category]} mr-2"></div>
                        <span class="text-sm">${categoryNames[category]}</span>
                    </div>
                    <span class="text-xs text-gray-500">${categoryCounts[category] || 0}</span>
                </div>
            `).join('');
        }

        // Update calendar
        function updateCalendar() {
            const monthNames = ["January", "February", "March", "April", "May", "June",
                              "July", "August", "September", "October", "November", "December"];
            
            currentMonthElement.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Get first day of month and total days in month
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Get today's date for comparison
            const today = new Date();
            const isCurrentMonth = today.getMonth() === currentMonth && today.getFullYear() === currentYear;
            
            // Get tasks for this month
            const monthTasks = tasks.filter(task => {
                const taskDate = new Date(task.dueDate);
                return taskDate.getMonth() === currentMonth && taskDate.getFullYear() === currentYear;
            });
            
            // Group tasks by day
            const tasksByDay = {};
            monthTasks.forEach(task => {
                const day = new Date(task.dueDate).getDate();
                tasksByDay[day] = (tasksByDay[day] || 0) + 1;
            });
            
            // Create calendar grid
            let calendarHTML = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += `<div class="calendar-day opacity-30"></div>`;
            }
            
            // Add cells for each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const hasTasks = tasksByDay[day];
                const isToday = isCurrentMonth && day === today.getDate();
                
                calendarHTML += `
                    <div class="calendar-day rounded-md p-1 text-center cursor-pointer ${isToday ? 'today' : ''} ${hasTasks ? 'has-tasks font-medium' : ''}"
                         onclick="filterByDate(${day})">
                        ${day}
                        ${hasTasks ? `<div class="h-1 w-1 mx-auto mt-1 rounded-full ${isToday ? 'bg-white' : 'bg-blue-500'}" title="${hasTasks} task(s)"></div>` : ''}
                    </div>
                `;
            }
            
            calendarElement.innerHTML = calendarHTML;
        }

        // Change month
        function changeMonth(offset) {
            currentMonth += offset;
            
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            } else if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            
            updateCalendar();
        }

        // Filter by selected date
        function filterByDate(day) {
            const selectedDate = new Date(currentYear, currentMonth, day);
            filterDate.value = 'all'; // Reset date filter dropdown
            
            // Set the date filter to show only tasks on this day
            const filteredTasks = tasks.filter(task => {
                const taskDate = new Date(task.dueDate);
                return taskDate.getDate() === day && 
                       taskDate.getMonth() === currentMonth && 
                       taskDate.getFullYear() === currentYear;
            });
            
            // Update counts
            totalCountElement.textContent = tasks.length;
            filteredCountElement.textContent = filteredTasks.length;
            
            // Display tasks
            if (filteredTasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="p-6 text-center text-gray-500">
                        No tasks found for ${selectedDate.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}.
                    </div>
                `;
                return;
            }
            
            tasksContainer.innerHTML = filteredTasks.map(task => {
                const dueDate = new Date(task.dueDate);
                const now = new Date();
                const isOverdue = !task.completed && dueDate < now;
                
                const formattedDate = dueDate.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                
                let formattedTime = '';
                if (dueDate.getHours() !== 0 || dueDate.getMinutes() !== 0) {
                    formattedTime = dueDate.toLocaleTimeString('en-US', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                }
                
                const priorityStyle = priorityStyles[task.priority];
                const categoryColor = categoryColors[task.category];
                
                return `
                    <div class="task-card fade-in p-4 border-l-4 ${isOverdue ? 'priority-high' : task.priority === 'high' ? 'priority-high' : task.priority === 'medium' ? 'priority-medium' : 'priority-low'}">
                        <div class="flex items-start justify-between">
                            <div class="flex items-start space-x-3">
                                <button onclick="toggleTaskCompletion(${task.id})" class="mt-1 flex-shrink-0">
                                    <i class="${task.completed ? 'fas fa-check-circle text-green-500' : 'far fa-circle text-gray-300'} text-lg"></i>
                                </button>
                                <div>
                                    <div class="flex items-center flex-wrap gap-2">
                                        <h3 class="${task.completed ? 'line-through text-gray-400' : 'text-gray-800'} font-medium">${task.title}</h3>
                                        <span class="text-xs px-2 py-1 rounded-full ${priorityStyle.bg} ${priorityStyle.color}">
                                            <i class="${priorityStyle.icon} mr-1"></i>
                                            ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                                        </span>
                                        <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600">
                                            <span class="inline-block w-2 h-2 rounded-full ${categoryColor} mr-1"></span>
                                            ${categoryNames[task.category]}
                                        </span>
                                    </div>
                                    ${task.description ? `<p class="text-sm text-gray-600 mt-1">${task.description}</p>` : ''}
                                    <div class="flex items-center mt-2 text-sm ${isOverdue ? 'text-red-500' : 'text-gray-500'}">
                                        <i class="far fa-calendar-alt mr-1"></i>
                                        ${formattedDate}${formattedTime ? ` • ${formattedTime}` : ''}
                                        ${isOverdue ? ' • Overdue' : ''}
                                    </div>
                                </div>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="editTask(${task.id})" class="text-gray-400 hover:text-blue-500">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                                <button onclick="deleteTask(${task.id})" class="text-gray-400 hover:text-red-500">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Clear all filters
        function clearFilters() {
            filterStatus.value = 'all';
            filterPriority.value = 'all';
            filterCategory.value = 'all';
            filterDate.value = 'all';
            updateTasksList();
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
